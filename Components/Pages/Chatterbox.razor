@page "/chatterbox"
@rendermode InteractiveServer
@using chatterbox_ui.Services
@inject ChatterboxService ChatterboxService

<PageTitle>Chatterbox TTS</PageTitle>

<h1>Chatterbox Text-to-Speech</h1>

<div class="container-fluid mt-4">
    <div class="row">
        <!-- Voice List and Upload -->
        <div class="col-md-4">
            <VoiceList 
                Voices="@voices" 
                SelectedVoiceId="@selectedVoiceId"
                OnVoiceSelect="@HandleVoiceSelect"
                OnVoicesChanged="@HandleVoicesChanged" />
            
            <div class="mt-3">
                <VoiceUpload OnUploadComplete="@HandleUploadComplete" />
            </div>
        </div>

        <!-- Synthesis & Playback -->
        <div class="col-md-8">
            <SynthesisPanel 
                Voices="@voices"
                SelectedVoiceId="@selectedVoiceId"
                OnVoiceIdChanged="@HandleVoiceIdChanged" />
        </div>
    </div>
</div>

@code {
    private List<chatterbox_ui.Services.VoiceInfo> voices = new();
    private string? selectedVoiceId;

    private async Task HandleVoiceSelect(string voiceId)
    {
        selectedVoiceId = voiceId;
        StateHasChanged();
        await Task.CompletedTask;
    }

    private async Task HandleVoiceIdChanged(string voiceId)
    {
        selectedVoiceId = voiceId;
        StateHasChanged();
        await Task.CompletedTask;
    }

    private async Task HandleVoicesChanged()
    {
        // Voices list was updated, refresh the reference
        StateHasChanged();
        await Task.CompletedTask;
    }

    private async Task HandleUploadComplete()
    {
        // Trigger voices refresh - the VoiceList component handles this internally
        StateHasChanged();
        await Task.CompletedTask;
    }
}
